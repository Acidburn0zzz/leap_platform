{
  "service_type": "internal_service",
  "x509": {
    "use": true
  },
  "stunnel": {
    "couch_server": "= stunnel_server(couch.port)",
    "bigcouch_replication_server": "= stunnel_server(couch.bigcouch.port)"
  },
  "stunnel": "= nextport = 4000; nodes_like_me[:services => :couchdb].values.inject({}) {|hsh, node| hsh[node.name + node.couch.bigcouch.port.to_s] =    {'accept_port' => nextport.to_s, 'connect' => node.domain.full }; nextport+=1; hsh}",
  "couch": {
    "port": 5984,
    "bigcouch": {
      "port": 4369,
      "cookie": "= secret :bigcouch_cookie"
    },
    "users": {
      "admin": {
        "username": "admin",
        "password": "= secret :couch_admin_password"
      },
      "webapp": {
        "username": "webapp",
        "password": "= secret :couch_webapp_password"
      },
      "ca_daemon": {
        "username": "ca_daemon",
        "password": "= secret :couch_ca_daemon_password"
      }
    }
  }
}
